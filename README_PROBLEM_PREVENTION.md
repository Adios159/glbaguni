# 🛡️ 글바구니 문제 예방 가이드

## 📋 개요

이 문서는 글바구니 프로젝트에서 발생할 수 있는 일반적인 문제들을 예방하고 해결하기 위한 종합 가이드입니다.

## 🚨 주요 문제점들과 해결책

### 1. 포트 충돌 문제
**문제:** 백엔드와 프론트엔드가 서로 다른 포트에서 실행되어 연결 실패
**해결책:**
- 백엔드는 **8000 포트** 사용 권장
- 프론트엔드 `.env.local` 파일에 `VITE_API_BASE=http://127.0.0.1:8000` 설정
- 포트 변경 시 두 설정을 모두 동기화

### 2. Import 에러
**문제:** `attempted relative import beyond top-level package` 등 import 관련 오류
**해결책:**
- 모든 라우터에 안전한 import 구조 적용 ✅
- 절대/상대 경로 모두 지원하는 fallback 구조 구현 ✅
- 히스토리 라우터 수정 완료 ✅

### 3. 컴포넌트 초기화 실패
**문제:** fetcher, summarizer 등 컴포넌트 초기화 실패로 서버 불안정
**해결책:**
- fetcher를 선택적 컴포넌트로 변경 ✅
- 강건한 헬스체크 로직 구현 ✅
- 재시도 메커니즘 추가 ✅

### 4. 환경변수 누락
**문제:** 필수 환경변수 누락으로 기능 동작 안함
**해결책:**
- 환경변수 검증 스크립트 추가 ✅
- 프론트엔드 `.env.local` 파일 생성 ✅
- 설정 가이드 문서화 ✅

### 5. 라우터 등록 오류
**문제:** 라우터 파일 문제로 서버 시작 실패
**해결책:**
- 필수/선택적 라우터 구분 ✅
- 강건한 라우터 등록 로직 구현 ✅
- 다양한 라우터 객체 패턴 지원 ✅

## 🔧 구현된 보완책들

### 1. 문제 예방 스크립트 (`problem_prevention.py`)
```bash
cd glbaguni-backend
python problem_prevention.py
```
- 포트 사용 현황 검증
- 환경변수 설정 확인
- Python 의존성 검증
- 파일 구조 검증
- import 경로 검증
- 컴포넌트 초기화 검증

### 2. 개선된 라우터 등록 시스템
- 필수 라우터 실패 시 서버 중단
- 선택적 라우터 실패 시 경고만 출력하고 계속 실행
- 다양한 라우터 객체 패턴 자동 감지

### 3. 강건한 컴포넌트 관리
- 초기화 실패 시 재시도 메커니즘
- 헬스체크 기능 강화
- 선택적/필수 컴포넌트 구분

### 4. 안전한 Import 구조
- 절대/상대 경로 모두 지원
- fallback 메커니즘으로 import 에러 방지
- 로깅을 통한 디버깅 지원

### 5. 환경변수 관리 시스템
- 자동 검증 및 누락 항목 알림
- 프론트엔드 환경변수 자동 생성
- 개발/프로덕션 환경 분리

## 📊 구현 결과

최신 검증 결과 (문제 예방 스크립트 실행):
- ✅ **총 8개 검증 항목 중 6개 성공**
- ⚠️ **2개 경고 (치명적이지 않음)**
- ❌ **0개 오류**

### 검증 항목들:
1. ✅ 포트 검증 (경고: 사용 중인 포트 감지됨)
2. ✅ 환경변수 검증 (경고: 선택적 변수 누락)
3. ✅ Python 의존성 검증
4. ✅ 파일 구조 검증
5. ✅ Import 경로 검증
6. ✅ 설정 파일 검증
7. ✅ 라우터 파일 검증
8. ✅ 컴포넌트 초기화 검증

## 🚀 권장 실행 순서

### 1. 시스템 검증
```bash
cd glbaguni-backend
python problem_prevention.py
```

### 2. 백엔드 실행
```bash
cd glbaguni-backend
python -m uvicorn backend.main:app --host 0.0.0.0 --port 8000 --reload
```

### 3. 프론트엔드 실행
```bash
cd glbaguni-frontend
# 환경변수 파일이 없다면 생성
echo "VITE_API_BASE=http://127.0.0.1:8000" > .env.local
npm run dev
```

### 4. 동작 확인
- 백엔드 헬스체크: http://localhost:8000/health
- 프론트엔드: http://localhost:5173 (또는 Vite 할당 포트)

## 🛠️ 문제 발생 시 대처법

### 1. 포트 충돌
```bash
# 다른 포트로 백엔드 실행
python -m uvicorn backend.main:app --port 8000 --reload

# 프론트엔드 환경변수 수정
echo "VITE_API_BASE=http://127.0.0.1:8000" > .env.local
```

### 2. Import 에러
```bash
# 의존성 재설치
pip install -r requirements.txt --force-reinstall
```

### 3. 컴포넌트 실패
- 선택적 컴포넌트 실패는 정상 (서버 계속 실행됨)
- 필수 컴포넌트 실패 시 로그 확인하여 환경변수 점검

### 4. 라우터 등록 실패
- 필수 라우터만 실패 시 서버 중단
- 선택적 라우터 실패는 경고만 출력

## 📈 성능 모니터링

### 헬스체크 엔드포인트
- `/health` - 기본 헬스체크
- `/health/detailed` - 상세 시스템 정보
- `/health/simple` - 로드밸런서용 간단 체크
- `/status/services` - 서비스 상태 확인

### 로그 모니터링
```bash
# 실시간 로그 확인
tail -f logs/glbaguni.log

# 에러만 필터링
grep ERROR logs/glbaguni.log
```

## 🔄 지속적 개선

### 자동화된 검증
- 서버 시작 시 자동 컴포넌트 검증
- 라우터 등록 실패 시 상세 로깅
- 환경변수 누락 시 친화적 오류 메시지

### 모니터링 강화
- 컴포넌트 상태 실시간 추적
- 자동 복구 메커니즘
- 성능 지표 수집

### 개발자 경험 개선
- 명확한 에러 메시지
- 자동 수정 제안
- 단계별 문제 해결 가이드

## 📞 추가 지원

### 문제 리포트
문제 발생 시 다음 정보를 포함하여 리포트:
1. `python problem_prevention.py` 실행 결과
2. `problem_prevention_results.json` 파일 내용
3. 에러 로그 (`logs/glbaguni.log`)
4. 실행 환경 정보 (OS, Python 버전 등)

### 개발 모드 활성화
```bash
# 디버그 모드로 실행
python -m uvicorn backend.main:app --port 8000 --reload --log-level debug
```

## 🎯 결론

이제 글바구니 프로젝트는 다음과 같은 문제 예방 메커니즘을 갖추었습니다:

1. **자동 검증 시스템** - 시스템 상태를 자동으로 점검
2. **강건한 에러 처리** - 부분 실패 시에도 서비스 계속 제공
3. **명확한 가이드** - 문제 발생 시 단계별 해결 방법 제시
4. **모니터링 도구** - 실시간 상태 확인 및 성능 추적
5. **자동 복구** - 가능한 문제들의 자동 수정 시도

이러한 개선사항으로 인해 앞으로는 이전에 발생했던 문제들이 크게 줄어들 것으로 예상됩니다. 